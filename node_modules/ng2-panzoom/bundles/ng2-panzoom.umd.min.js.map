{"version":3,"sources":["ng://ng2-panzoom/lib/panzoom-config.ts","ng://ng2-panzoom/lib/panzoom.component.ts","ng://ng2-panzoom/lib/ng2-panzoom.module.ts"],"names":["PanZoomConfig","options","this","zoomLevels","neutralZoomLevel","scalePerZoomLevel","initialZoomLevel","friction","haltSpeed","initialPanX","initialPanY","initialZoomToFit","keepInBounds","keepInBoundsDragPullback","keepInBoundsRestoreForce","panOnClickDrag","dragMouseButton","zoomButtonIncrement","zoomOnDoubleClick","zoomOnMouseWheel","invertMouseWheel","zoomStepDuration","zoomToFitZoomLevelFactor","freeMouseWheel","freeMouseWheelFactor","noDragFromElementClass","modelChanged","BehaviorSubject","isPanning","zoomLevel","pan","x","y","api","model","config","changeZoomLevel","zoomIn","zoomOut","zoomToFit","getViewPosition","getModelPosition","resetView","panToPoint","panDelta","panDeltaPercent","panDeltaAbsolute","console","warn","PanZoomComponent","el","zone","_this","previousPosition","isDragging","panVelocity","animationParams","lastTick","isChrome","willChangeNextFrame","isMobile","isFirstSync","zoomLevelIsChanging","dragFinishing","onMouseWheel","event","pageX","pageY","deltaY","clickPoint","jQueryFrameElement","offset","left","top","lastClickPoint","freeZoom","onMousedown","isParentElement","srcElement","button","type","preventDefault","lastMouseEventTime","timeStamp","runOutsideAngular","document","addEventListener","onTouchEnd","onTouchMove","passive","capture","onMouseMove","onMouseUp","onTouchStart","touches","length","now","timeSinceLastMouseEvent","dragDelta","topLeftCornerView","bottomRightCornerView","contentWidth","contentHeight","Math","min","pow","delta","syncBaseToModel","animationTick","performance","panzoomOverlayRef","nativeElement","style","display","length_1","abs","centerX","centerY","base","initialMultiplier","max","animationId","animationFrameFunc","removeEventListener","onDblClick","timestamp","deltaTime","progress","duration","updateDOM","dTime","next","acceleratedFrameRef","willChange","scale","getCssScale","prototype","ngOnInit","calcZoomToFit","zoomToLevelAndPoint","bind","zoomInToLastClickPoint","zoomOutFromLastClickPoint","maxZoomLevel","maxScale","minScale","minimumAllowedZoomLevel","zoomElementRef","navigator","userAgent","search","transform","frameElementRef","ngAfterViewInit","$","children","height","width","frameHeight","frameWidth","window","requestAnimationFrame","isMobileDevice","ngOnDestroy","cancelAnimationFrame","className","child","node","parentNode","classList","contains","deltaZoomLevel","deltaTranslation","panStepFunc","scaleString","transformOrigin","translate3d","panElementRef","wheelDelta","currentPan","currentScale","newScale","targetPoint","getZoomLevel","orientation","indexOf","vector2d","sqrt","getCenterPoint","offsetWidth","offsetHeight","cssScale","log10","rect","viewportWidth","viewportHeight","targetWidth","targetHeight","cssScaleExact","zoomToFitModel","target","animateToTarget","level","startAnimation","modelPosition","translation","viewPosition","pmark","s","t","error","log","rectangle","point","deltaPercent","deltaX","targetModel","oldBase","newZoomLevel","destPoint","targetScale","Component","args","selector","template","ElementRef","NgZone","ViewChild","static","Input","Ng2PanZoomModule","NgModule","imports","declarations","providers","exports"],"mappings":"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","sourcesContent":["import { Subject, BehaviorSubject } from 'rxjs';\nimport { Rect } from './panzoom-rect';\nimport { PanZoomModel } from './panzoom-model';\nimport { PanZoomAPI } from './panzoom-api';\n\nexport class PanZoomConfig {\n\n  zoomLevels = 5;\n  neutralZoomLevel = 2;\n  scalePerZoomLevel = 2.0;\n  initialZoomLevel = this.neutralZoomLevel;\n  friction = 10.0;\n  haltSpeed = 100.0;\n  initialPanX = 0;\n  initialPanY = 0;\n  initialZoomToFit: Rect = null;\n  keepInBounds = false;\n  keepInBoundsDragPullback = 0.7;\n  keepInBoundsRestoreForce = 0.5;\n  panOnClickDrag = true;\n  dragMouseButton = 'left'; // left, middle, right\n  zoomButtonIncrement = 1.0;\n  zoomOnDoubleClick = true;\n  zoomOnMouseWheel = true;\n  invertMouseWheel = false;\n  zoomStepDuration = 0.2;\n  zoomToFitZoomLevelFactor = 0.95;\n  freeMouseWheel = true;\n  freeMouseWheelFactor = 0.08;\n  noDragFromElementClass: string = null;\n  modelChanged: BehaviorSubject<PanZoomModel> = new BehaviorSubject<PanZoomModel>({\n    isPanning: null,\n    zoomLevel: null,\n    pan: {\n      x: null,\n      y: null\n    }\n  });\n  api: BehaviorSubject<PanZoomAPI> = new BehaviorSubject<PanZoomAPI>({\n    model: null,\n    config: null,\n    changeZoomLevel: null,\n    zoomIn: null,\n    zoomOut: null,\n    zoomToFit: null,\n    getViewPosition: null,\n    getModelPosition: null,\n    resetView: null,\n    panToPoint: null,\n    panDelta: null,\n    panDeltaPercent: null,\n    panDeltaAbsolute: null\n  });\n\n\n\n  constructor(options = null) {\n    if (!options) {\n      return;\n    }\n    if ('zoomLevels' in options) {\n      this.zoomLevels = options.zoomLevels;\n    }\n    if ('neutralZoomLevel' in options) {\n      this.neutralZoomLevel = options.neutralZoomLevel;\n    }\n    if ('scalePerZoomLevel' in options) {\n      this.scalePerZoomLevel = options.scalePerZoomLevel;\n    }\n    if ('initialZoomLevel' in options) {\n      this.initialZoomLevel = options.initialZoomLevel;\n    }\n    if ('friction' in options) {\n      this.friction = options.friction;\n    }\n    if ('haltSpeed' in options) {\n      this.haltSpeed = options.haltSpeed;\n    }\n    if ('initialPanX' in options) {\n      this.initialPanX = options.initialPanX;\n    }\n    if ('initialPanY' in options) {\n      this.initialPanY = options.initialPanY;\n    }\n    if ('initialZoomToFit' in options) {\n      this.initialZoomToFit = options.initialZoomToFit;\n    }\n    if ('keepInBounds' in options) {\n      this.keepInBounds = options.keepInBounds;\n    }\n    if ('keepInBoundsDragPullback' in options) {\n      this.keepInBoundsDragPullback = options.keepInBoundsDragPullback;\n    }\n    if ('keepInBoundsRestoreForce' in options) {\n      this.keepInBoundsRestoreForce = options.keepInBoundsRestoreForce;\n    }\n    if ('panOnClickDrag' in options) {\n      this.panOnClickDrag = options.panOnClickDrag;\n    }\n    if ('dragMouseButton' in options) {\n      this.dragMouseButton = options.dragMouseButton;\n    }\n    if ('zoomButtonIncrement' in options) {\n      this.zoomButtonIncrement = options.zoomButtonIncrement;\n    }\n    if ('zoomOnDoubleClick' in options) {\n      this.zoomOnDoubleClick = options.zoomOnDoubleClick;\n    }\n    if ('zoomOnMouseWheel' in options) {\n      this.zoomOnMouseWheel = options.zoomOnMouseWheel;\n    }\n    if ('invertMouseWheel' in options) {\n      this.invertMouseWheel = options.invertMouseWheel;\n    }\n    if ('zoomStepDuration' in options) {\n      this.zoomStepDuration = options.zoomStepDuration;\n    }\n    if ('zoomToFitZoomLevelFactor' in options) {\n      this.zoomToFitZoomLevelFactor = options.zoomToFitZoomLevelFactor;\n    }\n    if ('freeMouseWheel' in options) {\n      this.freeMouseWheel = options.freeMouseWheel;\n    }\n    if ('freeMouseWheelFactor' in options) {\n      this.freeMouseWheelFactor = options.freeMouseWheelFactor;\n    }\n    if (this.keepInBounds && this.neutralZoomLevel !== 0) {\n      console.warn('You have set keepInBounds to true and neutralZoomLevel to ' + this.neutralZoomLevel + '. Be aware that the zoom level cannot go below ' + this.neutralZoomLevel);\n    }\n    if ('noDragFromElementClass' in options) {\n      this.noDragFromElementClass = options.noDragFromElementClass;\n    }\n\n  }\n}\n","import { Component, OnInit, AfterViewInit, OnDestroy, ElementRef, ViewChild, Input, NgZone } from '@angular/core';\nimport { PanZoomConfig } from './panzoom-config';\nimport { Point } from './panzoom-point';\nimport { PanZoomModel } from './panzoom-model';\nimport { PanZoomAPI } from './panzoom-api';\nimport { Rect } from './panzoom-rect';\ndeclare var $: any;\n\n/*\nvar oldAddEventListener = EventTarget.prototype.addEventListener;\n\nEventTarget.prototype.addEventListener = function(eventName, eventHandler: any, options: any = null)\n{\n  console.log('eventName:', eventName);\n  oldAddEventListener.call(this, eventName, function(event) {\n    eventHandler(event);\n  }, options);\n};\n*/\n\ninterface ZoomAnimation {\n  deltaZoomLevel: number;\n  panStepFunc: Function;\n  duration: number;\n  progress: number;\n}\n\ninterface Position {\n  x?: number;\n  y?: number;\n  length?: number;\n}\n\n@Component( {\n  // tslint:disable-next-line:component-selector\n  selector: 'pan-zoom',\n  // we don't want to kill change detection for all elements beneath this, so we don't set OnPush.  Child views can implement OnPush if the developer wants to.  We can get away with this because the kwheel directive runs outside of Angular, so it doesnt trigger change detection.\n  template: `\n<div #frameElement class=\"pan-zoom-frame\" style=\"position:relative; width: 100%; height: 100%; overflow: hidden;\">\n  <div #panElement class=\"panElement\" style=\"position: absolute; left: 0px; top: 0px;\">\n    <div #zoomElement class=\"zoomElement\">\n      <ng-content></ng-content>\n    </div>\n  </div>\n</div>\n<div #panzoomOverlay style=\"position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0; display: none; pointer-events: none;\"></div>\n  `\n} )\n\nexport class PanZoomComponent implements OnInit, AfterViewInit, OnDestroy {\n\n  constructor ( private el: ElementRef,\n                private zone: NgZone ) {}\n\n  @ViewChild('frameElement', { static: true }) private frameElementRef: ElementRef;\n  @ViewChild('panElement', { static: true }) private panElementRef: ElementRef;\n  @ViewChild('zoomElement', { static: true }) private zoomElementRef: ElementRef;\n  @ViewChild('panzoomOverlay', { static: true }) private panzoomOverlayRef: ElementRef;\n\n  @Input() private config: PanZoomConfig;\n\n  private base: PanZoomModel; // this is what the pan/zoom view is before a zoom animation begins and after it ends.  It also updates with every mouse drag or freeZoom\n  private model: PanZoomModel; // this is used for incremental changes to the pan/zoom view during each animation frame.  Setting it will update the pan/zoom coordinates on the next call to updateDOM().  Not used during mouse drag or freeZoom\n  private api: PanZoomAPI;\n  private contentHeight: number;\n  private contentWidth: number;\n  private frameHeight: number;\n  private frameWidth: number;\n  private lastMouseEventTime: number;\n  private previousPosition: Position = null;\n  private isDragging = false;\n  private panVelocity: Point = null;\n  private animationParams: ZoomAnimation = null;\n  private jQueryFrameElement: JQuery;\n  private animationFrameFunc: Function; // reference to the appropriate getAnimationFrame function for the client browser\n  private lastTick = 0;\n  private isChrome = false;\n  private willChangeNextFrame = true; // used for scaling in Chrome\n  private animationId: number;\n  private isMobile = false;\n  private scale: number;\n  private isFirstSync = true;\n  private lastClickPoint: Point;\n  private acceleratedFrameRef: any;\n  private zoomLevelIsChanging = false;\n  private dragFinishing = false;\n  private dragMouseButton: number = null;\n\n  private maxScale: number; // the highest scale (furthest zoomed in) that we will allow in free zoom mode (calculated)\n  private minScale: number; // the smallest scale (furthest zoomed out) that we will allow in free zoom mode (calculated)\n  private minimumAllowedZoomLevel: number;\n\n\n\n  ngOnInit(): void {\n    // console.log('PanZoomComponent: ngOnInit(): initializing PanZoomComponent');\n\n    if (this.config.initialZoomToFit) {\n      this.base = this.calcZoomToFit(this.config.initialZoomToFit);\n    }\n    else {\n      this.base = {\n        zoomLevel: this.config.initialZoomLevel,\n        pan: {\n          x: this.config.initialPanX,\n          y: this.config.initialPanY\n        }\n      };\n    }\n\n    this.model = {\n      zoomLevel: this.base.zoomLevel,\n      isPanning: false, // Only true if panning is actually taking place, not just after mousedown\n      pan: {\n        x: this.base.pan.x,\n        y: this.base.pan.y\n      }\n    };\n\n    this.config.modelChanged.next(this.model);\n\n    // create public API\n    this.api = {\n      model: this.model,\n      config: this.config,\n      changeZoomLevel: this.zoomToLevelAndPoint.bind(this),\n      zoomIn: this.zoomInToLastClickPoint.bind(this),\n      zoomOut: this.zoomOutFromLastClickPoint.bind(this),\n      zoomToFit: this.zoomToFit.bind(this),\n      resetView: this.resetView.bind(this),\n      getViewPosition: this.getViewPosition.bind(this),\n      getModelPosition: this.getModelPosition.bind(this),\n      panToPoint: this.panToPoint.bind(this),\n      panDelta: this.panDelta.bind(this),\n      panDeltaPercent: this.panDeltaPercent.bind(this),\n      panDeltaAbsolute: this.panDeltaAbsolute.bind(this)\n    };\n\n    this.config.api.next(this.api);\n\n    if (this.config.freeMouseWheel) {\n      this.scale = this.getCssScale(this.config.initialZoomLevel);\n      let maxZoomLevel = this.config.zoomLevels - 1;\n      this.maxScale = this.getCssScale(maxZoomLevel);\n      this.minScale = this.getCssScale(0);\n    }\n\n    this.minimumAllowedZoomLevel = 0;\n    if (this.config.keepInBounds) {\n      this.minimumAllowedZoomLevel = this.config.neutralZoomLevel;\n      this.minScale = this.getCssScale(this.config.neutralZoomLevel);\n    }\n\n    this.acceleratedFrameRef = this.zoomElementRef;\n    // console.log('frameHeight:', this.frameHeight);\n    // console.log('frameWidth:', this.frameWidth);\n\n    (<any>this.acceleratedFrameRef.nativeElement.style).willChange = 'transform';\n    if (navigator.userAgent.search('Chrome') >= 0) {\n      this.isChrome = true;\n      this.acceleratedFrameRef.nativeElement.style.transform = 'translateZ(0)';\n    }\n\n    this.animationTick(performance.now());\n    this.scale = this.getCssScale(this.base.zoomLevel);\n    this.isFirstSync = false;\n    switch (this.config.dragMouseButton) {\n      case 'left':\n        this.dragMouseButton = 0;\n        break;\n      case 'middle':\n        this.dragMouseButton = 1;\n        this.zone.runOutsideAngular( () => this.frameElementRef.nativeElement.addEventListener('auxclick', this.preventDefault ) );\n        break;\n      case 'right':\n        this.zone.runOutsideAngular( () => document.addEventListener('contextmenu', this.preventDefault ) );\n        this.dragMouseButton = 2;\n        break;\n      default:\n        this.dragMouseButton = 0; // left\n    }\n\n\n  }\n\n\n\n  ngAfterViewInit(): void {\n    // console.log('PanZoomComponent: ngAfterViewInit()');\n\n    this.jQueryFrameElement = $('.pan-zoom-frame');\n    this.contentHeight = $('.zoomElement').children().height();\n    this.contentWidth = $('.zoomElement').children().width();\n    this.frameHeight = this.jQueryFrameElement.height();\n    this.frameWidth = this.jQueryFrameElement.width();\n\n    this.zone.runOutsideAngular( () => this.animationFrameFunc = window.requestAnimationFrame );\n    // this.zone.runOutsideAngular( () => this.wheelAnimationFrameFunc = window.requestAnimationFrame );\n\n\n    if (this.isMobileDevice())Â {\n      this.isMobile = true;\n      this.zone.runOutsideAngular( () => this.frameElementRef.nativeElement.addEventListener('touchstart', this.onTouchStart ) );\n    }\n    else {\n      this.zone.runOutsideAngular( () => this.frameElementRef.nativeElement.addEventListener('mousedown', this.onMousedown ) );\n      this.zone.runOutsideAngular( () => this.frameElementRef.nativeElement.addEventListener('dblclick', this.onDblClick ) );\n      this.zone.runOutsideAngular( () => this.frameElementRef.nativeElement.addEventListener('wheel', (event) => this.animationFrameFunc( () => this.onMouseWheel(event) ), { passive: true } ) );\n    }\n\n  }\n\n\n\n  ngOnDestroy(): void {\n    // console.log('PanZoomComponent: ngOnDestroy()');\n    if (this.isMobile) {\n      this.frameElementRef.nativeElement.removeEventListener('touchstart', this.onTouchStart);\n    }\n    else {\n      this.frameElementRef.nativeElement.removeEventListener('mousedown', this.onMousedown);\n      this.frameElementRef.nativeElement.removeEventListener('wheel', (event) => this.animationFrameFunc( () => this.onMouseWheel(event) ), { passive: true } );\n      this.frameElementRef.nativeElement.removeEventListener('dblclick', this.onDblClick);\n    }\n    if (this.animationFrameFunc && this.animationId) {\n      window.cancelAnimationFrame(this.animationId);\n    }\n    switch (this.config.dragMouseButton) {\n      case 'middle':\n        this.dragMouseButton = 1;\n        this.zone.runOutsideAngular( () => this.frameElementRef.nativeElement.removeEventListener('auxclick', this.preventDefault ) );\n        break;\n      case 'right':\n        this.zone.runOutsideAngular( () => document.removeEventListener('contextmenu', this.preventDefault ) );\n        this.dragMouseButton = 2;\n        break;\n    }\n  }\n\n\n\n  //////////////////////////// END OF LIFECYCLE HOOKS ////////////////////////////\n\n\n\n\n\n\n\n\n  ////////////////////////////////////////////////////////////////////////////////\n  ///////////////////////////////// EVENT HANDLERS ///////////////////////////////\n  ////////////////////////////////////////////////////////////////////////////////\n\n\n\n  private onMouseWheel = (event: WheelEvent) => {\n    // console.log('PanZoomComponent: OnMouseWheel() event:', event);\n\n    if (!(event && event.pageX && event.pageY)) {\n      return;\n    }\n\n    // let event = e.event;\n    let deltaY = event.deltaY;\n\n    if (this.config.zoomOnMouseWheel) {\n      // event.preventDefault();\n\n      if (this.animationParams) {\n        return; // already zooming\n      }\n\n      if (!this.config.invertMouseWheel) {\n        deltaY = -deltaY;\n      }\n\n      // console.log('deltaY:', event.deltaY);\n\n      // let sign = event.deltaY / Math.abs(event.deltaY);\n\n      let clickPoint: Point = {\n        x: event.pageX - this.jQueryFrameElement.offset().left,\n        y: event.pageY - this.jQueryFrameElement.offset().top\n      };\n\n      this.lastClickPoint = clickPoint;\n\n      if (this.config.freeMouseWheel) {\n        // free wheel scroll\n        this.freeZoom(clickPoint, deltaY);\n      }\n      else {\n        // let sign = Math.sign(event.deltaY);\n        if (deltaY < 0) {\n          this.zoomIn(clickPoint);\n        }\n        else if (deltaY > 0) {\n          this.zoomOut(clickPoint);\n        }\n      }\n    }\n  }\n\n\n\n  /**\n   * Method will check if 'child' node element is a child of\n   * parent node with class 'className'\n   * @param className\n   * @param child\n   */\n  private isParentElement(className, child) {\n    let node = child.parentNode;\n    while (node != null) {\n      if (node.classList && node.classList.contains(className)) {\n        return true;\n      }\n      node = node.parentNode;\n    }\n    return false;\n  }\n\n\n\n  private onMousedown = (event: any) => {\n    // console.log('PanZoomComponent: onMousedown()', event);\n\n    /* Check if clicked location is inside element from which\n       dragging is prevented. */\n    if (this.config.noDragFromElementClass\n        && this.isParentElement(this.config.noDragFromElementClass, event.srcElement)) {\n      return;\n    }\n\n    if (event.button === this.dragMouseButton || event.type === 'touchstart') {\n      event.preventDefault();\n      // event.stopPropagation();\n\n      this.dragFinishing = false;\n      this.panVelocity = null;\n\n      if (this.config.panOnClickDrag) {\n        this.previousPosition = {\n          x: event.pageX,\n          y: event.pageY\n        };\n        this.lastMouseEventTime = event.timeStamp;\n        this.isDragging = true;\n        this.model.isPanning = false;\n\n        if (this.isMobile) {\n          this.zone.runOutsideAngular( () => document.addEventListener('touchend', this.onTouchEnd, false ) ); // leave this on document\n          this.zone.runOutsideAngular( () => document.addEventListener('touchmove', this.onTouchMove, { passive: true, capture: false } ) ); // leave this on document\n        }\n        else {\n          this.zone.runOutsideAngular( () => document.addEventListener('mousemove', this.onMouseMove, { passive: true, capture: false } ) ); // leave this on document\n          this.zone.runOutsideAngular( () => document.addEventListener('mouseup', this.onMouseUp ) ); // leave this on document\n        }\n      }\n\n      return false;\n    }\n  }\n\n\n\n  private onTouchStart = (event: TouchEvent) => {\n    // console.log('PanZoomComponent: onTouchStart()', event);\n    // console.log('PanZoomComponent: onTouchStart(): touches:', event.touches.length);\n\n    event.preventDefault();\n    // event.stopPropagation();\n\n    if (event.touches.length !== 1) {\n      // multiple touches, get ready for zooming\n\n      // Calculate x and y distance between touch events\n      let x = event.touches[0].pageX - event.touches[1].pageX;\n      let y = event.touches[0].pageY - event.touches[1].pageY;\n\n      // Calculate length between touch points with pythagoras\n      // There is no reason to use Math.pow and Math.sqrt as we\n      // only want a relative length and not the exact one.\n      this.previousPosition = {\n        length: x * x + y * y\n      };\n    }\n    this.onMousedown(event);\n  }\n\n\n\n  private onMouseMove = (event: any) => {\n    // console.log('PanZoomComponent: onMouseMove()', event);\n    // console.log(`PanZoomComponent: onMouseMove(): event.timeStamp:`, event.timeStamp);\n    // timestamp - 10587.879999999132 - milliseconds\n    // Called when moving the mouse with the left button down\n\n    // event.preventDefault();\n    // event.stopPropagation();\n\n    if (!(event && event.pageX && event.pageY)) {\n      return;\n    }\n\n    let now = event.timeStamp;\n    let timeSinceLastMouseEvent = (now - this.lastMouseEventTime) / 1000; // orig\n    // let timeSinceLastMouseEvent = (now - this.lastMouseEventTime);\n    this.lastMouseEventTime = now;\n    let dragDelta = {\n      // a representation of how far each coordinate has moved since the last time it was moved\n      x: event.pageX - this.previousPosition.x,\n      y: event.pageY - this.previousPosition.y\n    };\n\n    if (this.config.keepInBounds) {\n      let topLeftCornerView = this.getViewPosition( { x: 0, y: 0 } );\n      let bottomRightCornerView = this.getViewPosition( { x: this.contentWidth, y: this.contentHeight } );\n\n\n      if (topLeftCornerView.x > 0 && dragDelta.x > 0) {\n        dragDelta.x *= Math.min(1,\n                                Math.pow(topLeftCornerView.x, -this.config.keepInBoundsDragPullback)\n                               );\n      }\n\n      if (topLeftCornerView.y > 0 && dragDelta.y > 0) {\n        dragDelta.y *= Math.min(1,\n                                  Math.pow(topLeftCornerView.y, -this.config.keepInBoundsDragPullback)\n                                );\n      }\n\n      if (bottomRightCornerView.x < this.contentWidth && dragDelta.x < 0) {\n        dragDelta.x *= Math.min(1,\n                                  Math.pow(this.contentWidth - bottomRightCornerView.x, -this.config.keepInBoundsDragPullback)\n                               );\n      }\n\n      if (bottomRightCornerView.y < this.contentHeight && dragDelta.y < 0) {\n        dragDelta.y *= Math.min(1,\n                                 Math.pow(this.contentHeight - bottomRightCornerView.y, -this.config.keepInBoundsDragPullback)\n                               );\n      }\n    }\n\n    // now pan the view\n    let delta: Point = {\n      x: dragDelta.x || 0,\n      y: dragDelta.y || 0\n    };\n    this.model.pan.x += delta.x;\n    this.model.pan.y += delta.y;\n    this.syncBaseToModel();\n    this.animationTick(performance.now());\n\n    if (!this.model.isPanning) {\n      // This will improve the performance,\n      // because the browser stops evaluating hits against the elements displayed inside the pan zoom view.\n      // Besides this, mouse events will not be sent to any other elements,\n      // this prevents issues like selecting elements while dragging.\n      this.panzoomOverlayRef.nativeElement.style.display = 'block';\n    }\n\n    this.model.isPanning = true;\n\n    // set these for the animation slow down once drag stops\n    // panVelocity is a measurement of speed for x and y coordinates, in pixels per mouse move event.  It is a measure of how fast the mouse is moving\n    this.panVelocity = {\n      x: dragDelta.x / timeSinceLastMouseEvent,\n      y: dragDelta.y / timeSinceLastMouseEvent\n    };\n    // console.log(`PanZoomComponent: onMouseMove(): panVelocity:`, this.panVelocity);\n\n    this.previousPosition = {\n      x: event.pageX,\n      y: event.pageY\n    };\n\n  }\n\n\n\n  private onTouchMove = (event: any) => {\n    // console.log('PanZoomComponent: onTouchMove()');\n    // console.log('PanZoomComponent: onTouchMove(): event:', event);\n\n    // event.preventDefault();\n    // event.stopPropagation();\n\n    if (event.touches.length === 1) {\n      // single touch, emulate mouse move\n      this.onMouseMove(event);\n    }\n    else {\n      // multiple touches, zoom in/out\n      // console.log('pinch zooming');\n\n      // Calculate x and y distance between touch events\n      let x = event.touches[0].pageX - event.touches[1].pageX;\n      let y = event.touches[0].pageY - event.touches[1].pageY;\n      // Calculate length between touch points with pythagoras\n      // There is no reason to use Math.pow and Math.sqrt as we\n      // only want a relative length and not the exact one.\n      let length = x * x + y * y;\n\n      // Calculate delta between current position and last position\n      let delta = length - this.previousPosition.length;\n\n      // Naive hysteresis\n      if (Math.abs(delta) < 100) {\n        return;\n      }\n\n      // Calculate center between touch points\n      let centerX = event.touches[1].pageX + x / 2;\n      let centerY = event.touches[1].pageY + y / 2;\n\n      // Calculate zoom center\n      let clickPoint = {\n        x: centerX - this.jQueryFrameElement.offset().left,\n        y: centerY - this.jQueryFrameElement.offset().top\n      };\n      this.lastClickPoint = clickPoint;\n\n      this.changeZoomLevel( this.base.zoomLevel + delta * 0.0001, clickPoint);\n      // this.freeZoom( clickPoint, delta);\n\n      // Update length for next move event\n      this.previousPosition = {\n        length: length\n      };\n    }\n  }\n\n\n\n  private onMouseUp = (event) => {\n    // console.log('PanZoomComponent: onMouseup()', event);\n\n    if (event.button !== this.dragMouseButton) {\n      return;\n    }\n\n    event.preventDefault();\n    // event.stopPropagation();\n\n    let now = event.timeStamp;\n    let timeSinceLastMouseEvent = (now - this.lastMouseEventTime) / 1000; // orig\n\n    if (this.panVelocity && (this.panVelocity.x !== 0 || this.panVelocity.y !== 0) ) {\n      // apply strong initial dampening if the mouse up occured much later than the last mouse move, indicating that the mouse hasn't moved recently\n      // TBD - experiment with this formula\n      let initialMultiplier = Math.max(\n        0,\n        -0.2 + Math.pow(timeSinceLastMouseEvent + 1, -4)\n        );\n\n        this.panVelocity.x *= initialMultiplier;\n        this.panVelocity.y *= initialMultiplier;\n        this.dragFinishing = true;\n        // console.log(`PanZoomComponent: onMouseUp(): panVelocity:`, this.panVelocity);\n        this.zone.runOutsideAngular( () => this.animationId = this.animationFrameFunc(this.animationTick) );\n      }\n      else {\n        this.dragFinishing = false;\n        this.panVelocity = null;\n      }\n\n      this.isDragging = false;\n      // this.model.isPanning = false;\n\n      if (this.isMobile) {\n        this.zone.runOutsideAngular( () => document.removeEventListener('touchend', this.onTouchEnd) );\n        this.zone.runOutsideAngular( () => document.removeEventListener('touchmove', this.onTouchMove, <any>{ passive: true, capture: false } ) );\n      }\n      else {\n        this.zone.runOutsideAngular( () => document.removeEventListener('mousemove', this.onMouseMove, <any>{ passive: true, capture: false } ));\n        this.zone.runOutsideAngular( () => document.removeEventListener('mouseup', this.onMouseUp, <any>{ passive: true } ));\n    }\n\n    // Set the overlay to non-blocking again:\n    this.panzoomOverlayRef.nativeElement.style.display = 'none';\n  }\n\n\n\n  private onTouchEnd = (event: any) => {\n    // console.log('PanZoomComponent: onTouchEnd()');\n    this.onMouseUp(event);\n  }\n\n\n\n  private onDblClick = (event: any) => {\n    // console.log('PanZoomComponent: onDblClick()');\n    event.preventDefault();\n    // event.stopPropagation();\n    if (!this.config.zoomOnDoubleClick) {\n      return;\n    }\n\n    let clickPoint: Point = {\n      x: event.pageX - this.jQueryFrameElement.offset().left,\n      y: event.pageY - this.jQueryFrameElement.offset().top\n    };\n    this.lastClickPoint = clickPoint;\n    this.zoomIn(clickPoint);\n  }\n\n\n\n  private preventDefault = (event: any) => {\n    event.preventDefault();\n  }\n\n\n\n\n  ////////////////////////////////////////////////////////////////////////////////\n  ///////////////////////////// END EVENT HANDLERS ///////////////////////////////\n  ////////////////////////////////////////////////////////////////////////////////\n\n\n\n\n\n\n\n\n\n\n  ////////////////////////////////////////////////////////////////////////////////\n  ///////////////////////////// APPLY ANIMATIONS /////////////////////////////////\n  ////////////////////////////////////////////////////////////////////////////////\n\n\n\n  private animationTick = (timestamp: number) => {\n    // console.log('PanZoomComponent: animationTick()');\n    // timestamp looks like 76916.963.  The unit is milliseconds and should be accurate to 5 Âµs (microseconds)\n\n    let deltaTime = 0;\n    if (this.lastTick !== 0) {\n      deltaTime = (timestamp - this.lastTick); // orig - milliseconds since the last animationTick\n    }\n    this.lastTick = timestamp;\n\n    if (this.animationParams) {\n      // when we're running an animation (but not waiting for a released drag to halt)\n      // console.log('PanZoomComponent: animationTick(): model is zooming');\n\n      this.animationParams.progress += Math.abs(deltaTime / this.animationParams.duration);\n\n      if (this.animationParams.progress >= 1.0) {\n        // Only when the animation has finished, sync the base to the model.\n        this.animationParams.progress = 1.0;\n        this.updateDOM();\n        this.animationParams = null;\n      }\n    }\n\n    if (this.panVelocity && this.dragFinishing) {\n      // This is when we've panned and released the mouse button and the view is \"free-floating\" until it slows to a halt.  Don't let the while loop fool you - this only applies it for the current frame.\n      // Prevent overshooting if delta time is large for some reason. We apply the simple solution of slicing delta time into smaller pieces and applying each one\n      if (deltaTime > 0) {\n        deltaTime = deltaTime / 1000;\n      }\n      while (deltaTime > 0) {\n        let dTime = Math.min(.02, deltaTime);\n        deltaTime = deltaTime - dTime;\n\n        this.model.pan.x = this.model.pan.x + this.panVelocity.x * dTime;\n        this.panVelocity.x = this.panVelocity.x * (1 - this.config.friction * dTime);\n\n        this.model.pan.y = this.model.pan.y + this.panVelocity.y * dTime;\n        this.panVelocity.y = this.panVelocity.y * (1 - this.config.friction * dTime);\n\n        let speed = this.length(this.panVelocity);\n\n        if (speed < this.config.haltSpeed) {\n          this.model.isPanning = false;\n          this.panVelocity = null;\n          this.dragFinishing = false;\n          break;\n        }\n\n      }\n    }\n\n    if (this.config.keepInBounds || this.dragFinishing) {\n      // Checks that keepInBounds is set and that the mouse button isn't pressed, and if so, it stops the contents from going out of view\n      // console.log('PanZoomComponent: animationTick(): keepInBounds');\n      let topLeftCornerView = this.getViewPosition({ x: 0, y: 0 });\n      let bottomRightCornerView = this.getViewPosition({ x: this.contentWidth, y: this.contentHeight });\n\n      if (topLeftCornerView.x > 0) {\n        this.base.pan.x -= this.config.keepInBoundsRestoreForce * topLeftCornerView.x;\n      }\n\n      if (topLeftCornerView.y > 0) {\n        this.base.pan.y -= this.config.keepInBoundsRestoreForce * topLeftCornerView.y;\n      }\n\n      if (bottomRightCornerView.x < this.contentWidth) {\n        this.base.pan.x -= this.config.keepInBoundsRestoreForce * (bottomRightCornerView.x - this.contentWidth);\n      }\n\n      if (bottomRightCornerView.y < this.contentHeight) {\n        this.base.pan.y -= this.config.keepInBoundsRestoreForce * (bottomRightCornerView.y - this.contentHeight);\n      }\n    }\n\n    this.updateDOM();\n    this.config.modelChanged.next(this.model);\n\n\n    if ( this.animationParams || (this.panVelocity && this.dragFinishing) ) {\n      // Are we in an animation?  If so, run the next frame\n\n      if (this.isChrome && this.zoomLevelIsChanging) {\n        // run will-change toggle hack on Chrome to trigger re-rasterization\n        // see https://developers.google.com/web/updates/2016/09/re-rastering-composite\n        if (this.willChangeNextFrame) {\n          (<any>this.acceleratedFrameRef.nativeElement.style).willChange = 'auto';\n        }\n        else {\n          (<any>this.acceleratedFrameRef.nativeElement.style).willChange = 'transform';\n        }\n        this.willChangeNextFrame = !this.willChangeNextFrame;\n      }\n      // console.log('calling next tick');\n      this.animationFrameFunc(this.animationTick); // Call the next animation frame\n    }\n    else if (this.panVelocity && !this.dragFinishing) {\n      // we're just mouse-panning the frame.  We don't need another tick\n      return;\n    }\n    else {\n      // Animation has ended\n      this.syncBaseToModel();\n      this.scale = this.getCssScale(this.base.zoomLevel);\n      this.willChangeNextFrame = true;\n      (<any>this.acceleratedFrameRef.nativeElement.style).willChange = 'transform';\n      this.zoomLevelIsChanging = false;\n      this.lastTick = 0;\n    }\n\n  }\n\n\n\n  private updateDOM() {\n    // console.log('PanZoomComponent: updateDOM()');\n    // Called by ngAfterViewInit() and animationTick()\n    // This function does not get called by freeZoom(), which operates independently of animationTick() and updateDOM().\n\n    if (this.animationParams) {\n      // we're running an animation sequence (but not freeZooming or panning with onMouseMove() )\n      this.model.zoomLevel = this.base.zoomLevel + this.animationParams.deltaZoomLevel * this.animationParams.progress; // calculate how far we need to zoom in or out for the current animationTick\n      let deltaTranslation = this.animationParams.panStepFunc(this.model.zoomLevel); // calculate how far to pan the view to based on our translated coordinates\n\n      // sync the model pan coordinates to our translated pan coordinates\n      // we do this by adding how far we want to move in each direction to our our existing base pan coordinates (where we started)\n      this.model.pan.x = this.base.pan.x + deltaTranslation.x;\n      this.model.pan.y = this.base.pan.y + deltaTranslation.y;\n\n      if (this.config.keepInBounds) {\n        let topLeftCornerView = this.getViewPosition({ x: 0, y: 0 });\n        let bottomRightCornerView = this.getViewPosition({ x: this.contentWidth, y: this.contentHeight });\n\n        if (topLeftCornerView.x > 0) {\n          this.model.pan.x = 0;\n        }\n\n        if (topLeftCornerView.y > 0) {\n          this.model.pan.y = 0;\n        }\n\n        if (bottomRightCornerView.x < this.contentWidth) {\n          this.model.pan.x -= (bottomRightCornerView.x - this.contentWidth);\n        }\n\n        if (bottomRightCornerView.y < this.contentHeight) {\n          this.model.pan.y -= (bottomRightCornerView.y - this.contentHeight);\n        }\n      }\n    }\n\n    ////////////////////////////////////////////////////\n    //////////////////// APPLY SCALING /////////////////\n    ////////////////////////////////////////////////////\n    if (this.animationParams || this.isFirstSync) {\n      let scale = this.getCssScale(this.model.zoomLevel);\n      let scaleString = `scale(${scale})`;\n      this.zoomElementRef.nativeElement.style.transformOrigin = '0 0';\n      this.zoomElementRef.nativeElement.style.transform = scaleString;\n    }\n\n    ////////////////////////////////////////////////////\n    //////////////// APPLY PAN ANIMATION ///////////////\n    ////////////////////////////////////////////////////\n    let translate3d = `translate3d(${this.model.pan.x}px, ${this.model.pan.y}px, 0)`;\n    this.panElementRef.nativeElement.style.transform = translate3d;\n\n  }\n\n\n\n  private freeZoom(clickPoint: Point, wheelDelta: number): void {\n    // console.log('PanZoomComponent: freeZoom(): this.base:', this.base);\n\n    if (this.isDragging) {\n      // don't allow zooming if the mouse is down\n      return;\n    }\n\n    // now handle interruption of an in-progress animation\n    if (this.animationParams) {\n      this.animationParams = null; // cancel an existing animation\n    }\n\n    if (this.panVelocity) {\n      this.dragFinishing = false;\n      this.panVelocity = null;\n    }\n\n    let currentPan: Point = {\n      // the current base coordinates\n      x: this.base.pan.x,\n      y: this.base.pan.y\n    };\n    // !!!something, somewhere is potentially invalidating the base pan!!!\n    let currentScale = this.scale; // get the current CSS scale (scale0)\n\n    let newScale = this.scale + (wheelDelta * this.config.freeMouseWheelFactor * this.scale);\n\n    // takes either the minimum scale (furthest allowable zoomed out) or the calculated current scale, whichever is greater, unless calculated current scale exceeds maxScale (furthest allowable zoomed in), in which case maxScale is used\n    newScale = Math.max(this.minScale, Math.min( this.maxScale, newScale ));\n    this.scale = newScale;\n\n    let targetPoint: Point = {\n      // The target point to zoom to.  It must stay the same as the untranslated point\n      x: clickPoint.x - (newScale / currentScale) * (clickPoint.x - currentPan.x),\n      y: clickPoint.y - (newScale / currentScale) * (clickPoint.y - currentPan.y)\n    };\n\n    // Apply Pan & Scale\n    let translate3d = `translate3d(${targetPoint.x}px, ${targetPoint.y}px, 0)`;\n    this.panElementRef.nativeElement.style.transform = translate3d;\n    let scaleString = `scale(${this.scale})`;\n    this.zoomElementRef.nativeElement.style.transformOrigin = '0 0';\n    this.zoomElementRef.nativeElement.style.transform = scaleString;\n\n    if (this.isChrome) {\n      if (this.willChangeNextFrame) {\n        (<any>this.acceleratedFrameRef.nativeElement.style).willChange = 'auto';\n      }\n      else {\n        (<any>this.acceleratedFrameRef.nativeElement.style).willChange = 'transform';\n      }\n      this.willChangeNextFrame = !this.willChangeNextFrame;\n    }\n\n    this.model.pan.x = targetPoint.x;\n    this.model.pan.y = targetPoint.y;\n    this.model.zoomLevel = this.getZoomLevel(this.scale);\n    this.syncBaseToModel();\n    this.config.modelChanged.next(this.model);\n    // console.log(`PanZoomComponent: freeZoom(): baseAfterZoom: x: ${this.base.pan.x} y: ${this.base.pan.y} zoomlevel: ${this.base.zoomLevel}` );\n    // console.log('zoomLevel:', this.base.zoomLevel);\n  }\n\n\n\n\n\n\n  ////////////////////////////////////////////////////\n  //////////////// HELPER FUNCTIONS //////////////////\n  ////////////////////////////////////////////////////\n\n\n\n  private isMobileDevice(): boolean {\n    return (typeof window.orientation !== 'undefined') || (navigator.userAgent.indexOf('IEMobile') !== -1);\n  }\n\n\n\n\n  private syncBaseToModel() {\n    this.base.pan.x = this.model.pan.x;\n    this.base.pan.y = this.model.pan.y;\n    this.base.zoomLevel = this.model.zoomLevel;\n  }\n\n\n\n  private length(vector2d: any) {\n    // console.log('PanZoomComponent: length()');\n    return Math.sqrt(vector2d.x * vector2d.x + vector2d.y * vector2d.y);\n  }\n\n\n\n  private getCenterPoint(): Point {\n    // console.log('PanZoomComponent: getCenterPoint()');\n    // console.log('PanZoomComponent: getCenterPoint(): projectedContentRef:', this.projectedContentRef);\n    let center = {\n      // x: this.jQueryFrameElement.width() / 2,\n      x: this.frameElementRef.nativeElement.offsetWidth / 2,\n      // x: this.projectedContentRef.nativeElement.offsetWidth / 2,\n      // y: this.jQueryFrameElement.height() / 2\n      y: this.frameElementRef.nativeElement.offsetHeight / 2\n      // y: this.projectedContentRef.nativeElement.offsetHeight / 2\n    };\n    return center;\n  }\n\n\n\n  private getCssScale(zoomLevel: any): number {\n    // console.log('PanZoomComponent: getCssScale()');\n    return Math.pow(this.config.scalePerZoomLevel, zoomLevel - this.config.neutralZoomLevel);\n  }\n\n\n\n  private getZoomLevel(cssScale: any) {\n    // console.log('PanZoomComponent: getZoomLevel()');\n    return Math.log10(cssScale) / Math.log10(this.config.scalePerZoomLevel) + this.config.neutralZoomLevel;\n  }\n\n\n\n  private calcZoomToFit(rect: Rect): PanZoomModel {\n    // console.log('PanZoomComponent: calcZoomToFit(): rect:', rect);\n    // let (W, H) denote the size of the viewport\n    // let (w, h) denote the size of the rectangle to zoom to\n    // then we must CSS scale by the min of W/w and H/h in order to just fit the rectangle\n    // returns the target left and top coordinates for the panElement and target zoomLevel\n\n    let viewportWidth = this.frameElementRef.nativeElement.offsetWidth;\n    let viewportHeight = this.frameElementRef.nativeElement.offsetHeight;\n\n    let targetWidth = rect.width;\n    let targetHeight = rect.height;\n\n    let cssScaleExact = Math.min( viewportWidth / targetWidth, viewportHeight / targetHeight );\n    let zoomLevelExact = this.getZoomLevel(cssScaleExact);\n    let zoomLevel = zoomLevelExact * this.config.zoomToFitZoomLevelFactor;\n    let cssScale = this.getCssScale(zoomLevel);\n\n    return {\n        zoomLevel: zoomLevel,\n        pan: {\n            x: -rect.x * cssScale + (viewportWidth - targetWidth * cssScale) / 2,\n            y: -rect.y * cssScale + (viewportHeight - targetHeight * cssScale) / 2\n        }\n    };\n  }\n\n\n\n  private zoomToFitModel(target: PanZoomModel, duration: number = null) {\n    // console.log('PanZoomComponent: zoomToFitModel(): target:', target);\n\n    // target.pan.x is the panElement left style property\n    // target.pan.y is the panElement top style property\n    this.animateToTarget(target, duration);\n  }\n\n\n\n  private zoomToLevelAndPoint(level: number, clickPoint: Point) {\n    // console.log('PanZoomComponent: zoomToLevelAndPoint(): level:', level);\n    // console.log('PanZoomComponent: zoomToLevelAndPoint(): clickPoint:', clickPoint);\n    this.changeZoomLevel( level, clickPoint );\n  }\n\n\n\n  private zoomInToLastClickPoint() {\n    // console.log('PanZoomComponent: zoomInToLastClickPoint(): lastClickPoint', this.lastClickPoint);\n    this.changeZoomLevel( this.base.zoomLevel + this.config.zoomButtonIncrement, this.lastClickPoint );\n  }\n\n\n\n  private zoomOutFromLastClickPoint() {\n    // console.log('PanZoomComponent: zoomOutFromLastClickPoint()');\n    this.changeZoomLevel( this.base.zoomLevel - this.config.zoomButtonIncrement, this.lastClickPoint );\n  }\n\n\n\n  private startAnimation() {\n    this.lastTick = performance.now();\n    this.zone.runOutsideAngular( () => this.animationId = this.animationFrameFunc(this.animationTick) );\n  }\n\n\n\n\n\n\n\n  ////////////////////////////////////////////////////\n  /////////////////// API METHODS ////////////////////\n  ////////////////////////////////////////////////////\n\n\n\n  private getViewPosition(modelPosition: Point): Point {\n    // console.log('PanZoomComponent: getViewPosition()');\n    // p' = p * s + t\n    // viewPosition = modelPosition * scale + basePan\n\n    let scale, translation;\n\n    if (this.animationParams) {\n      scale = this.getCssScale(this.base.zoomLevel + this.animationParams.deltaZoomLevel * this.animationParams.progress);\n      let deltaTranslation = this.animationParams.panStepFunc(this.model.zoomLevel);\n      translation = { x: this.base.pan.x + deltaTranslation.x, y: this.base.pan.y + deltaTranslation.y };\n    }\n    else {\n      scale = this.getCssScale(this.base.zoomLevel);\n      translation = this.base.pan;\n    }\n\n    return {\n      x: modelPosition.x * scale + translation.x,\n      y: modelPosition.y * scale + translation.y\n    };\n  }\n\n\n\n  private getModelPosition(viewPosition: Point) {\n    // console.log('PanZoomComponent: getModelPosition()');\n    // p = (1/s)(p' - t)\n    let pmark = viewPosition;\n    let s = this.getCssScale(this.base.zoomLevel);\n    let t = this.base.pan;\n\n    return {\n      x: (1 / s) * (pmark.x - t.x),\n      y: (1 / s) * (pmark.y - t.y)\n    };\n  }\n\n\n\n  private resetView() {\n    // console.log('PanZoomComponent: resetView()');\n    if (this.config.initialZoomToFit) {\n      this.zoomToFit(this.config.initialZoomToFit);\n    }\n    else if (this.config.initialPanX !== null && this.config.initialPanY !== null && this.config.initialZoomLevel !== null) {\n      this.zoomToFitModel(\n        {\n          zoomLevel: this.config.initialZoomLevel,\n          pan: {\n            x: this.config.initialPanX,\n            y: this.config.initialPanY\n          }\n        }\n      );\n    }\n    else {\n      console.error('PanZoomComponent: resetView() could not reset view as some vars were not set.  The culprits are either config.initialZoomLevel, config.initialPanX, or config.initialPanY.  Or just set panzoomConfig.initialZoomToFit');\n      console.log('config.initialZoomLevel: ' + this.config.initialZoomLevel);\n      console.log('config.initialPanX: ' + this.config.initialPanX);\n      console.log('config.initialPanY: ' + this.config.initialPanY);\n    }\n  }\n\n\n\n  private zoomToFit(rectangle: Rect, duration: number = null) {\n    // console.log('PanZoomComponent: zoomToFit(): rectangle', rectangle);\n\n    // when a user clicks a zoom to fit button\n    // example rectangle: { \"x\": 0, \"y\": 100, \"width\": 100, \"height\": 100 }\n\n    let target: PanZoomModel = this.calcZoomToFit(rectangle);\n    // target.pan.x is the panElement left style property\n    // target.pan.y is the panElement top style property\n    this.animateToTarget(target, duration);\n  }\n\n\n\n  private zoomIn(clickPoint: Point) {\n    // console.log('PanZoomComponent: zoomIn(): clickPoint:', clickPoint);\n    this.changeZoomLevel( this.base.zoomLevel + this.config.zoomButtonIncrement, clickPoint );\n  }\n\n\n\n  private zoomOut(clickPoint: Point) {\n    // console.log('PanZoomComponent: zoomOut()');\n    this.changeZoomLevel( this.base.zoomLevel - this.config.zoomButtonIncrement, clickPoint );\n  }\n\n\n\n  private panToPoint(point: Point, duration: number = null) {\n    // console.log('PanZoomComponent: panToPoint(): point:', point);\n\n    // API call to animate the view so that the centre point of the view is at the\n    // point parameter coordinates, relative to the original, unzoomed\n    // content width and height\n    // example point: { \"x\": 0, \"y\": 0 } // makes the top-left corner of the content\n    // the centre of the view\n\n    let target: PanZoomModel = {\n      pan: {\n        x: ( (this.frameWidth / 2) ) - point.x * this.scale,\n        y: ( (this.frameHeight / 2) ) - point.y * this.scale\n      },\n      zoomLevel: this.base.zoomLevel\n    };\n\n    this.animateToTarget(target, duration);\n  }\n\n\n\n  private panDelta(delta: Point, duration: number = null) {\n    // console.log('PanZoomComponent: panDelta(): delta:', delta);\n\n    // API call to pan the view left, right, up, or down, based on a number of pixels\n    // of the original, unzoomed content.\n    // Positive is right and down\n    // Negative is left and up\n    // example point: { \"x\": 100, \"y\": -50 } // moves the view right 50px and up 50px\n\n    let target: PanZoomModel = {\n      pan: {\n        x: this.base.pan.x - this.scale * delta.x,\n        y: this.base.pan.y - this.scale * delta.y\n      },\n      zoomLevel: this.base.zoomLevel\n    };\n    this.animateToTarget(target, duration);\n  }\n\n\n\n  private panDeltaAbsolute(delta: Point, duration: number = null) {\n    // console.log('PanZoomComponent: panDeltaAbsolute(): delta:', delta);\n\n    // API call to pan the view left, right, up, or down, based on a number of pixels\n    // This method doesn't adjust for scale.  I'm not sure why you'd want this\n    // but have it here just in case someone needs it\n    // Positive is right and down\n    // Negative is left and up\n    // example point: { \"x\": 100, \"y\": -50 } // moves the view right 50px and up 50px\n\n    let target: PanZoomModel = {\n      pan: {\n        x: this.base.pan.x - delta.x,\n        y: this.base.pan.y - delta.y\n      },\n      zoomLevel: this.base.zoomLevel\n    };\n    this.animateToTarget(target, duration);\n  }\n\n\n\n  private panDeltaPercent(deltaPercent: Point, duration: number = null) {\n    // console.log('PanZoomComponent: panDeltaPercent(): deltaPercent:', deltaPercent);\n\n    // API call to pan the view up, down, left, or right, based on a percentage\n    // of the original, unzoomed content width and height\n    // example point: { \"x\": 10, \"y\": -20 }\n\n    let deltaX = 0;\n    let deltaY = 0;\n    if (deltaPercent.x !== 0) {\n      deltaX = this.contentWidth * ( deltaPercent.x / 100 ) * this.scale;\n    }\n    if (deltaPercent.y !== 0) {\n      deltaY = this.contentHeight * ( deltaPercent.y / 100 ) * this.scale;\n    }\n\n    let target: PanZoomModel = {\n      pan: {\n        x: this.base.pan.x - deltaX,\n        y: this.base.pan.y - deltaY\n      },\n      zoomLevel: this.base.zoomLevel\n    };\n    // target.pan.x is the panElement left style property\n    // target.pan.y is the panElement top style property\n    this.animateToTarget(target, duration);\n  }\n\n\n\n\n\n\n\n  ////////////////////////////////////////////////////////////////////////////////\n  ///////////////////////////// ANIMATION BUILDERS ///////////////////////////////\n  ////////////////////////////////////////////////////////////////////////////////\n\n\n\n  private animateToTarget(targetModel: PanZoomModel, duration = null) {\n    // console.log('PanZoomComponent: animateToTarget()');\n    // what this function really does is take a target model, and then sets\n    // this.animationParams with the parameters for the whole animation,\n    // namely the delta zoomLevel\n    // it is the responsibility of the caller to kick off the animation with a call to animationFrameFunc()\n\n    if (this.animationParams) {\n      // make the user wait for existing animation to finish before clicking\n      return;\n    }\n\n    this.zoomLevelIsChanging = false;\n    if (this.base.zoomLevel !== targetModel.zoomLevel) {\n      this.zoomLevelIsChanging = true;\n    }\n\n    let deltaZoomLevel = targetModel.zoomLevel - this.base.zoomLevel; // deltaZoomLevel is the number of zoom levels we are changing here\n\n    let oldBase: Point = {\n      // the current base coordinates\n      x: this.base.pan.x,\n      y: this.base.pan.y\n    };\n    this.model.pan.x = this.base.pan.x;\n    this.model.pan.y = this.base.pan.y;\n    /*this.lastClickPoint = {\n      x: this.base.pan.x,\n      y: this.base.pan.y\n    };*/\n\n    let panStepFunc = (zoomLevel: number) => {\n      // this function gets called during every animation tick in updateDOM(), to calculate where to move the model pan coordinates to (i.e. the translation) for that tick, zoomLevel is ignored within animateToTarget()\n      let targetPoint: Point = {\n        // The target point to zoom to for the current animation frame.  It must stay the same as the untranslated point\n        x: (oldBase.x - targetModel.pan.x) * this.animationParams.progress,\n        y: (oldBase.y - targetModel.pan.y) * this.animationParams.progress\n      };\n\n      return { x: -targetPoint.x, y: -targetPoint.y };\n    };\n\n    // now set the parameters of our new animation\n    if (duration) {\n      duration = duration * 1000;\n    }\n    else {\n      duration = this.config.zoomStepDuration * 1000;\n    }\n    this.animationParams = {\n      deltaZoomLevel: deltaZoomLevel, // how many zooom levels to zoom in or out\n      panStepFunc: panStepFunc, // a function which runs on every animation tick, which calcs how much to pan the view on every frame\n      // duration: duration || this.config.zoomStepDuration, // how long the animation should take\n      duration: duration, // how long the animation should take\n      progress: 0.0\n    };\n\n    this.startAnimation();\n\n  }\n\n\n\n  private changeZoomLevel(newZoomLevel: number, clickPoint: Point) {\n    // console.log('PanZoomComponent: changeZoomLevel()');\n\n    if (this.animationParams) {\n      // let's let any current animation just finish\n      return;\n    }\n\n    this.zoomLevelIsChanging = true;\n\n    // keep zoom level in bounds\n    newZoomLevel = Math.max(this.minimumAllowedZoomLevel, newZoomLevel);\n    newZoomLevel = Math.min(this.config.zoomLevels - 1, newZoomLevel);\n    // console.log('newZoomLevel:', newZoomLevel);\n\n    let deltaZoomLevel = newZoomLevel - this.base.zoomLevel; // deltaZoomLevel is the number of zoom levels we are changing here\n    if (!deltaZoomLevel) {\n      // a deltaZoomLevel of zero means that we aren't changing zoom, because we're either zoomed all the way in or all the way out\n      return;\n    }\n\n    //\n    // Let p be the vector to the clicked point in view coords and let p' be the same point in model coords. Let s be a scale factor\n    // and let t be a translation vector. Let the transformation be defined as:\n    //\n    //  p' = p * s + t\n    //\n    // And conversely:\n    //\n    //  p = (1/s)(p' - t)\n    //\n    // Now use subscription 0 to denote the value before transform and zoom and let 1 denote the value after transform. Scale\n    // changes from s0 to s1. Translation changes from t0 to t1. But keep p and p' fixed so that the view coordinate p' still\n    // corresponds to the model coordinate p. This can be expressed as an equation relying upon solely upon p', s0, s1, t0, and t1:\n    //\n    //  (1/s0)(p - t0) = (1/s1)(p - t1)\n    //\n    // Every variable but t1 is known, thus it is easily isolated to:\n    //\n    //  t1 = p' - (s1/s0)*(p' - t0)\n    //\n\n    let currentPan: Point = {\n      // t0 - the current base coordinates\n      x: this.base.pan.x,\n      y: this.base.pan.y\n    };\n\n    let currentScale = this.scale; // s0 - get the current CSS scale (scale0)\n    let destPoint = clickPoint || this.getCenterPoint(); // pmark - the point we are aiming to zoom to (either the click point or the centre of the page)\n\n\n    let panStepFunc = (zoomLevel: number) => {\n      // this function gets called during every animation tick, to calculate where to move the model pan coordinates to (i.e. the translation) for that tick, where zoomLevel is calculated from the current zoomLevel + the target zoomLevel * the progress of the current animation\n\n      let targetScale = this.getCssScale(zoomLevel); // s1 - the scale to translate to for the current animation tick\n      let targetPoint: Point = {\n        // t1 - The target point to pan to.  It must stay the same as the untranslated point\n        x: destPoint.x - (targetScale / currentScale) * (destPoint.x - currentPan.x),\n        y: destPoint.y - (targetScale / currentScale) * (destPoint.y - currentPan.y)\n      };\n\n      return {\n        // now return the difference between our initial click point and our translated (zoomed) click point\n        // these are not absolute coordinates - just how far to move them\n        x: targetPoint.x - currentPan.x,\n        y: targetPoint.y - currentPan.y\n      };\n    };\n\n    // now set the parameters of our new animation\n    this.animationParams = {\n      deltaZoomLevel: deltaZoomLevel, // the destination zoom level for this zoom operation (when the animation is completed)\n      panStepFunc: panStepFunc,\n      // duration: this.config.zoomStepDuration, // how long the animation should take\n      duration: this.config.zoomStepDuration * 1000, // how long the animation should take\n      progress: 0.0\n    };\n    this.startAnimation();\n\n  }\n\n\n\n}\n","import { NgModule } from '@angular/core';\nimport { PanZoomComponent } from './panzoom.component';\nimport * as JQuery from 'jquery';\n\n@NgModule({\n  imports: [],\n  declarations: [ PanZoomComponent ],\n  providers: [],\n  exports: [ PanZoomComponent ]\n})\n\nexport class Ng2PanZoomModule { }\n"]}